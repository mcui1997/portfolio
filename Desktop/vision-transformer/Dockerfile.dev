FROM python:3.9-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    git \
    vim \
    wget \
    && rm -rf /var/lib/apt/lists/*

# Install CUDA support for GPU development (optional, comment out if not needed)
# Note: This significantly increases image size
# RUN wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-keyring_1.0-1_all.deb && \
#     dpkg -i cuda-keyring_1.0-1_all.deb && \
#     apt-get update && apt-get install -y cuda-toolkit-11-8 && \
#     rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /workspace

# Install Python dependencies for ML development
RUN pip install --no-cache-dir \
    numpy==1.24.3 \
    pandas==2.0.3 \
    scikit-learn==1.3.0 \
    matplotlib==3.7.2 \
    seaborn==0.12.2 \
    jupyter==1.0.0 \
    jupyterlab==4.0.3 \
    notebook==7.0.0 \
    ipykernel==6.25.0

# Install deep learning frameworks
RUN pip install --no-cache-dir \
    torch==2.0.1 \
    torchvision==0.15.2 \
    tensorflow==2.13.0 \
    keras==2.13.1

# Install MLOps tools
RUN pip install --no-cache-dir \
    mlflow==2.7.1 \
    dvc==3.20.0 \
    wandb==0.15.8 \
    optuna==3.3.0

# Install development tools
RUN pip install --no-cache-dir \
    black==23.7.0 \
    flake8==6.1.0 \
    mypy==1.5.1 \
    pytest==7.4.0 \
    pytest-cov==4.1.0 \
    pre-commit==3.3.3 \
    isort==5.12.0 \
    pylint==2.17.5

# Install additional useful libraries
RUN pip install --no-cache-dir \
    requests==2.31.0 \
    pyyaml==6.0.1 \
    python-dotenv==1.0.0 \
    tqdm==4.66.1 \
    click==8.1.6 \
    fastapi==0.103.0 \
    uvicorn==0.23.2 \
    pydantic==2.3.0

# Create necessary directories
RUN mkdir -p /workspace/data /workspace/models /workspace/notebooks /workspace/src

# Set up Jupyter configuration
RUN jupyter notebook --generate-config && \
    echo "c.NotebookApp.allow_root = True" >> ~/.jupyter/jupyter_notebook_config.py && \
    echo "c.NotebookApp.ip = '0.0.0.0'" >> ~/.jupyter/jupyter_notebook_config.py && \
    echo "c.NotebookApp.token = ''" >> ~/.jupyter/jupyter_notebook_config.py && \
    echo "c.NotebookApp.password = ''" >> ~/.jupyter/jupyter_notebook_config.py

# Set environment variables
ENV PYTHONUNBUFFERED=1
ENV JUPYTER_ENABLE_LAB=yes

# Expose ports
EXPOSE 8888 5000 6006

# Default command
CMD ["/bin/bash"]